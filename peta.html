<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta SIG Kelurahan Tonja</title>

    <!-- CSS WEBGIS / LEAFLET (dari QGIS2Web) -->
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">
    <link rel="stylesheet" href="css/leaflet.photon.css">

    <style>
        :root {
            --primary: #0b2c4a;
            --primary-dark: #061829;
            --accent-gold: #f4b321;
            --background: #f3f5f9;
            --text-main: #1f2933;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            line-height: 1.6;

            opacity: 0;
            transform: translateY(8px);
            animation: bodyFadeIn 520ms ease-out forwards;
        }

        @keyframes bodyFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        body.page-exit {
            animation: bodyFadeOut 320ms ease-in forwards;
        }

        @keyframes bodyFadeOut {
            to {
                opacity: 0;
                transform: translateY(8px);
            }
        }

        a { color: inherit; }

        .container {
            max-width: 1120px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        header {
            background:
                linear-gradient(135deg, rgba(15,23,42,0.9), rgba(6,24,41,0.98)),
                url("assets/img/atr-bg-1.jpg") center/cover no-repeat;
            color: #f9fafb;
            padding: 1.4rem 0 1.7rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.35);
            position: relative;
            overflow: hidden;
            will-change: background-position;
        }

        header::after {
            content: "";
            position: absolute;
            inset: 0;
            background:
                radial-gradient(circle at top left, rgba(244,179,33,0.28), transparent 55%),
                radial-gradient(circle at bottom right, rgba(15,118,210,0.28), transparent 55%);
            pointer-events: none;
            mix-blend-mode: screen;
        }

        .header-inner { position: relative; z-index: 1; }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.9rem;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            border-radius: 999px;
            overflow: hidden;
            border: 2px solid var(--accent-gold);
            background: #08243e;
        }

        .brand-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .brand-text h1 {
            margin: 0 0 0.1rem;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .brand-text p {
            margin: 0;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        nav { margin-top: 1rem; }

        .nav-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .nav-menu a {
            position: relative;
            text-decoration: none;
            color: #e5e7eb;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.07em;
            font-weight: 500;
            padding-bottom: 0.2rem;
            transition: color 150ms ease-out, transform 150ms ease-out;
        }

        .nav-menu a::after {
            content: "";
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background: var(--accent-gold);
            transition: width 180ms ease-out;
        }

        .nav-menu a:hover {
            color: #ffffff;
            transform: translateY(-1px);
        }

        .nav-menu a:hover::after,
        .nav-menu a.active::after {
            width: 100%;
        }

        main {
            padding: 2.4rem 0 3.4rem;
        }

        .section-heading h2 {
            margin: 0 0 0.4rem;
            font-size: 1.3rem;
            color: var(--primary-dark);
        }

        .section-heading p {
            margin: 0;
            font-size: 0.9rem;
            color: #6b7280;
        }

        /* WRAPPER PETA */
        .map-wrapper {
            margin-top: 1.4rem;
            border-radius: 16px;
            overflow: hidden;
            background: #e5e7eb;
            box-shadow:
                0 18px 40px rgba(15,23,42,0.08),
                0 0 0 1px rgba(148,163,184,0.22);
        }

        /* MAP CONTAINER (ganti style html/body 100% dari qgis2web) */
        #map {
            width: 100%;
            height: 550px;
        }

        @media (max-width: 600px) {
            #map {
                height: 420px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
            body {
                opacity: 1;
                transform: none;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="container header-inner">
        <div class="header-top">
            <div class="brand">
                <div class="brand-logo">
                    <img src="gambar/LOGO.png" alt="Logo ATR/BPN">
                </div>
                <div class="brand-text">
                    <h1>Peta SIG Kelurahan Tonja</h1>
                    <p>Halaman Peta WebGIS (Pengembangan)</p>
                </div>
            </div>
        </div>

        <nav>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="berita.html">Berita</a></li>
                <li><a href="publikasi.html">Publikasi</a></li>
                <li><a href="peta.html" class="active">Peta</a></li>
            </ul>
        </nav>
    </div>
</header>

<main>
    <div class="container">
        <div class="section-heading">
            <h2>Peta SIG Kelurahan Tonja</h2>
            <p>WebGIS interaktif hasil ekspor QGIS2Web yang menampilkan batas administrasi dan layer terkait.</p>
        </div>

        <!-- WRAPPER PETA -->
        <div class="map-wrapper">
            <div id="map"></div>
        </div>
    </div>
</main>

<!-- JS WEBGIS / LEAFLET (dari QGIS2Web) -->
<script src="js/qgis2web_expressions.js"></script>
<script src="js/leaflet.js"></script>
<script src="js/L.Control.Layers.Tree.min.js"></script>
<script src="js/L.Control.Locate.min.js"></script>
<script src="js/leaflet.rotatedMarker.js"></script>
<script src="js/leaflet.pattern.js"></script>
<script src="js/leaflet-hash.js"></script>
<script src="js/Autolinker.min.js"></script>
<script src="js/rbush.min.js"></script>
<script src="js/labelgun.min.js"></script>
<script src="js/labels.js"></script>
<script src="js/leaflet.photon.js"></script>

<!-- DATA GEOJSON (dari QGIS2Web) -->
<script src="data/ADMINISTRASI_AR_DESAKEL_1.js"></script>
<script src="data/ADMINISTRASI_LN_KABKOTA_2.js"></script>
<script src="data/SAWAH_AR_25K_3.js"></script>

<script>
    var map = L.map('map', {
        zoomControl: false,
        maxZoom: 28,
        minZoom: 1
    }).fitBounds([[-8.811321765716812,114.96197969509761],[-8.444599840916808,115.55458907056509]]);

    var hash = new L.Hash(map);
    map.attributionControl.setPrefix(
        '<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; ' +
        '<a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; ' +
        '<a href="https://qgis.org">QGIS</a>'
    );

    var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

    function removeEmptyRowsFromPopupContent(content, feature) {
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = content;
        var rows = tempDiv.querySelectorAll('tr');
        for (var i = 0; i < rows.length; i++) {
            var td = rows[i].querySelector('td.visible-with-data');
            var key = td ? td.id : '';
            if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                rows[i].parentNode.removeChild(rows[i]);
            }
        }
        return tempDiv.innerHTML;
    }

    function addClassToPopupIfMedia(content, popup) {
        var tempDiv = document.createElement('div');
        tempDiv.innerHTML = content;
        var imgTd = tempDiv.querySelector('td img');
        if (imgTd) {
            var src = imgTd.getAttribute('src');
            if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                popup._contentNode.classList.add('media');
                setTimeout(function() {
                    popup.update();
                }, 10);
            } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                var audio = document.createElement('audio');
                audio.controls = true;
                audio.src = src;
                imgTd.parentNode.replaceChild(audio, imgTd);
                popup._contentNode.classList.add('media');
                setTimeout(function() {
                    popup.setContent(tempDiv.innerHTML);
                    popup.update();
                }, 10);
            } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                var video = document.createElement('video');
                video.controls = true;
                video.src = src;
                video.style.width = "400px";
                video.style.height = "300px";
                video.style.maxHeight = "60vh";
                video.style.maxWidth = "60vw";
                imgTd.parentNode.replaceChild(video, imgTd);
                popup._contentNode.classList.add('media');
                video.addEventListener('loadedmetadata', function() {
                    popup.update();
                });
                setTimeout(function() {
                    popup.setContent(tempDiv.innerHTML);
                    popup.update();
                }, 10);
            } else {
                popup._contentNode.classList.remove('media');
            }
        } else {
            popup._contentNode.classList.remove('media');
        }
    }

    var zoomControl = L.control.zoom({
        position: 'topleft'
    }).addTo(map);

    L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);

    var bounds_group = new L.featureGroup([]);
    function setBounds() {}

    map.createPane('pane_OpenStreetMap_0');
    map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
    var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        pane: 'pane_OpenStreetMap_0',
        opacity: 1.0,
        attribution: '',
        minZoom: 1,
        maxZoom: 28,
        minNativeZoom: 0,
        maxNativeZoom: 19
    });
    map.addLayer(layer_OpenStreetMap_0);

    function pop_ADMINISTRASI_AR_DESAKEL_1(feature, layer) {
        var popupContent = '<table>\
                <tr>\
                    <th scope="row">OBJECTID</th>\
                    <td class="visible-with-data" id="OBJECTID">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th scope="row">Nama Objek</th>\
                    <td class="visible-with-data" id="NAMOBJ">' + (feature.properties['NAMOBJ'] !== null ? autolinker.link(String(feature.properties['NAMOBJ']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['FCODE'] !== null ? autolinker.link(String(feature.properties['FCODE']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['REMARK'] !== null ? autolinker.link(String(feature.properties['REMARK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['METADATA'] !== null ? autolinker.link(String(feature.properties['METADATA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SRS_ID'] !== null ? autolinker.link(String(feature.properties['SRS_ID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDBBPS'] !== null ? autolinker.link(String(feature.properties['KDBBPS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDCBPS'] !== null ? autolinker.link(String(feature.properties['KDCBPS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDCPUM'] !== null ? autolinker.link(String(feature.properties['KDCPUM']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDEBPS'] !== null ? autolinker.link(String(feature.properties['KDEBPS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDEPUM'] !== null ? autolinker.link(String(feature.properties['KDEPUM']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDPBPS'] !== null ? autolinker.link(String(feature.properties['KDPBPS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDPKAB'] !== null ? autolinker.link(String(feature.properties['KDPKAB']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KDPPUM'] !== null ? autolinker.link(String(feature.properties['KDPPUM']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['LUASWH'] !== null ? autolinker.link(String(feature.properties['LUASWH']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['TIPADM'] !== null ? autolinker.link(String(feature.properties['TIPADM']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WADMKD'] !== null ? autolinker.link(String(feature.properties['WADMKD']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WADMKK'] !== null ? autolinker.link(String(feature.properties['WADMKK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WADMPR'] !== null ? autolinker.link(String(feature.properties['WADMPR']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WIADKC'] !== null ? autolinker.link(String(feature.properties['WIADKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WIADKK'] !== null ? autolinker.link(String(feature.properties['WIADKK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WIADPR'] !== null ? autolinker.link(String(feature.properties['WIADPR']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WIADKD'] !== null ? autolinker.link(String(feature.properties['WIADKD']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['UUPP'] !== null ? autolinker.link(String(feature.properties['UUPP']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th scope="row">luas</th>\
                    <td class="visible-with-data" id="luas">' + (feature.properties['luas'] !== null ? autolinker.link(String(feature.properties['luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SHAPE_Length'] !== null ? autolinker.link(String(feature.properties['SHAPE_Length']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SHAPE_Area'] !== null ? autolinker.link(String(feature.properties['SHAPE_Area']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
            </table>';
        var content = removeEmptyRowsFromPopupContent(popupContent, feature);
        layer.on('popupopen', function(e) {
            addClassToPopupIfMedia(content, e.popup);
        });
        layer.bindPopup(content, { maxHeight: 400 });
    }

    function style_ADMINISTRASI_AR_DESAKEL_1_0() {
        return {
            pane: 'pane_ADMINISTRASI_AR_DESAKEL_1',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(196,60,57,1.0)',
            interactive: true,
        }
    }

    map.createPane('pane_ADMINISTRASI_AR_DESAKEL_1');
    map.getPane('pane_ADMINISTRASI_AR_DESAKEL_1').style.zIndex = 401;
    map.getPane('pane_ADMINISTRASI_AR_DESAKEL_1').style['mix-blend-mode'] = 'normal';

    var layer_ADMINISTRASI_AR_DESAKEL_1 = new L.geoJson(json_ADMINISTRASI_AR_DESAKEL_1, {
        attribution: '',
        interactive: true,
        dataVar: 'json_ADMINISTRASI_AR_DESAKEL_1',
        layerName: 'layer_ADMINISTRASI_AR_DESAKEL_1',
        pane: 'pane_ADMINISTRASI_AR_DESAKEL_1',
        onEachFeature: pop_ADMINISTRASI_AR_DESAKEL_1,
        style: style_ADMINISTRASI_AR_DESAKEL_1_0,
    });
    bounds_group.addLayer(layer_ADMINISTRASI_AR_DESAKEL_1);
    map.addLayer(layer_ADMINISTRASI_AR_DESAKEL_1);

    function pop_ADMINISTRASI_LN_KABKOTA_2(feature, layer) {
        var popupContent = '<table>\
                <tr>\
                    <th scope="row">OBJECTID</th>\
                    <td class="visible-with-data" id="OBJECTID">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th scope="row">Nama Objek</th>\
                    <td class="visible-with-data" id="NAMOBJ">' + (feature.properties['NAMOBJ'] !== null ? autolinker.link(String(feature.properties['NAMOBJ']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['FCODE'] !== null ? autolinker.link(String(feature.properties['FCODE']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['REMARK'] !== null ? autolinker.link(String(feature.properties['REMARK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['METADATA'] !== null ? autolinker.link(String(feature.properties['METADATA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SRS_ID'] !== null ? autolinker.link(String(feature.properties['SRS_ID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['ADMIN1'] !== null ? autolinker.link(String(feature.properties['ADMIN1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['ADMIN2'] !== null ? autolinker.link(String(feature.properties['ADMIN2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KARKTR'] !== null ? autolinker.link(String(feature.properties['KARKTR']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['KLBADM'] !== null ? autolinker.link(String(feature.properties['KLBADM']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['PJGBTS'] !== null ? autolinker.link(String(feature.properties['PJGBTS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['STSBTS'] !== null ? autolinker.link(String(feature.properties['STSBTS']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['TIPLOK'] !== null ? autolinker.link(String(feature.properties['TIPLOK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['TIPTBT'] !== null ? autolinker.link(String(feature.properties['TIPTBT']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['UUPP'] !== null ? autolinker.link(String(feature.properties['UUPP']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WADKC1'] !== null ? autolinker.link(String(feature.properties['WADKC1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WADKC2'] !== null ? autolinker.link(String(feature.properties['WADKC2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WAKBK1'] !== null ? autolinker.link(String(feature.properties['WAKBK1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WAKBK2'] !== null ? autolinker.link(String(feature.properties['WAKBK2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WAKLD1'] !== null ? autolinker.link(String(feature.properties['WAKLD1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WAKLD2'] !== null ? autolinker.link(String(feature.properties['WAKLD2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WAPRO1'] !== null ? autolinker.link(String(feature.properties['WAPRO1']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['WAPRO2'] !== null ? autolinker.link(String(feature.properties['WAPRO2']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['RuleID'] !== null ? autolinker.link(String(feature.properties['RuleID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['Override'] !== null ? autolinker.link(String(feature.properties['Override']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SHAPE_Length'] !== null ? autolinker.link(String(feature.properties['SHAPE_Length']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
            </table>';
        var content = removeEmptyRowsFromPopupContent(popupContent, feature);
        layer.on('popupopen', function(e) {
            addClassToPopupIfMedia(content, e.popup);
        });
        layer.bindPopup(content, { maxHeight: 400 });
    }

    function style_ADMINISTRASI_LN_KABKOTA_2_0() {
        return {
            pane: 'pane_ADMINISTRASI_LN_KABKOTA_2',
            opacity: 1,
            color: 'rgba(145,82,45,1.0)',
            dashArray: '',
            lineCap: 'square',
            lineJoin: 'bevel',
            weight: 1.0,
            fillOpacity: 0,
            interactive: true,
        }
    }

    map.createPane('pane_ADMINISTRASI_LN_KABKOTA_2');
    map.getPane('pane_ADMINISTRASI_LN_KABKOTA_2').style.zIndex = 402;
    map.getPane('pane_ADMINISTRASI_LN_KABKOTA_2').style['mix-blend-mode'] = 'normal';

    var layer_ADMINISTRASI_LN_KABKOTA_2 = new L.geoJson(json_ADMINISTRASI_LN_KABKOTA_2, {
        attribution: '',
        interactive: true,
        dataVar: 'json_ADMINISTRASI_LN_KABKOTA_2',
        layerName: 'layer_ADMINISTRASI_LN_KABKOTA_2',
        pane: 'pane_ADMINISTRASI_LN_KABKOTA_2',
        onEachFeature: pop_ADMINISTRASI_LN_KABKOTA_2,
        style: style_ADMINISTRASI_LN_KABKOTA_2_0,
    });
    bounds_group.addLayer(layer_ADMINISTRASI_LN_KABKOTA_2);
    map.addLayer(layer_ADMINISTRASI_LN_KABKOTA_2);

    function pop_SAWAH_AR_25K_3(feature, layer) {
        var popupContent = '<table>\
                <tr>\
                    <th scope="row">OBJECTID</th>\
                    <td class="visible-with-data" id="OBJECTID">' + (feature.properties['OBJECTID'] !== null ? autolinker.link(String(feature.properties['OBJECTID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th scope="row">Nama Objek</th>\
                    <td class="visible-with-data" id="NAMOBJ">' + (feature.properties['NAMOBJ'] !== null ? autolinker.link(String(feature.properties['NAMOBJ']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['FCODE'] !== null ? autolinker.link(String(feature.properties['FCODE']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['REMARK'] !== null ? autolinker.link(String(feature.properties['REMARK']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <th scope="row">METADATA</th>\
                    <td class="visible-with-data" id="METADATA">' + (feature.properties['METADATA'] !== null ? autolinker.link(String(feature.properties['METADATA']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SRS_ID'] !== null ? autolinker.link(String(feature.properties['SRS_ID']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['JNSSWH'] !== null ? autolinker.link(String(feature.properties['JNSSWH']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['TNMSWH'] !== null ? autolinker.link(String(feature.properties['TNMSWH']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['LAYER'] !== null ? autolinker.link(String(feature.properties['LAYER']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SHAPE_Length'] !== null ? autolinker.link(String(feature.properties['SHAPE_Length']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['SHAPE_Area'] !== null ? autolinker.link(String(feature.properties['SHAPE_Area']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                </tr>\
            </table>';
        var content = removeEmptyRowsFromPopupContent(popupContent, feature);
        layer.on('popupopen', function(e) {
            addClassToPopupIfMedia(content, e.popup);
        });
        layer.bindPopup(content, { maxHeight: 400 });
    }

    function style_SAWAH_AR_25K_3_0() {
        return {
            pane: 'pane_SAWAH_AR_25K_3',
            opacity: 1,
            color: 'rgba(35,35,35,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: 1.0,
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(164,113,88,1.0)',
            interactive: true,
        }
    }

    map.createPane('pane_SAWAH_AR_25K_3');
    map.getPane('pane_SAWAH_AR_25K_3').style.zIndex = 403;
    map.getPane('pane_SAWAH_AR_25K_3').style['mix-blend-mode'] = 'normal';

    var layer_SAWAH_AR_25K_3 = new L.geoJson(json_SAWAH_AR_25K_3, {
        attribution: '',
        interactive: true,
        dataVar: 'json_SAWAH_AR_25K_3',
        layerName: 'layer_SAWAH_AR_25K_3',
        pane: 'pane_SAWAH_AR_25K_3',
        onEachFeature: pop_SAWAH_AR_25K_3,
        style: style_SAWAH_AR_25K_3_0,
    });
    bounds_group.addLayer(layer_SAWAH_AR_25K_3);
    map.addLayer(layer_SAWAH_AR_25K_3);

    const url = {
        "Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "France BAN": "https://api-adresse.data.gouv.fr/search/?"
    };

    var photonControl = L.control.photon({
        url: url["Nominatim OSM"],
        feedbackLabel: '',
        position: 'topleft',
        includePosition: true,
        initial: true
    }).addTo(map);

    photonControl._container.childNodes[0].style.borderRadius = "10px";

    var x = null;
    var marker = null;
    var z = null;

    // PERBAIKAN: pakai variabel yang ada (x, marker), bukan obj2/obj3
    photonControl.on('selected', function(e) {
        if (x != null) {
            if (marker) {
                map.removeLayer(marker);
            }
            map.removeLayer(x);
        }

        x = L.geoJSON(e.choice).addTo(map);

        var label = (typeof e.choice.properties.label === 'undefined')
            ? e.choice.properties.display_name
            : e.choice.properties.label;

        marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
        map.setView(x.getLayers()[0].getLatLng(), 17);

        z = (typeof e.choice.properties.label === 'undefined')
            ? e.choice.properties.display_name
            : e.choice.properties.label;

        e.target.input.value = z;
    });

    var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
    search.classList.add("leaflet-control-search");
    search.style.display = "flex";
    search.style.backgroundColor = "rgba(255,255,255,0.5)";

    var button = document.createElement("div");
    button.id = "gcd-button-control";
    button.className = "gcd-gl-btn fa fa-search search-button";

    search.insertBefore(button, search.firstChild);
    var last = search.lastChild;
    last.style.display = "none";

    button.addEventListener("click", function () {
        if (last.style.display === "none") {
            last.style.display = "block";
        } else {
            last.style.display = "none";
        }
    });

    var overlaysTree = [
        {label: '<img src="legend/SAWAH_AR_25K_3.png" /> SAWAH_AR_25K', layer: layer_SAWAH_AR_25K_3},
        {label: '<img src="legend/ADMINISTRASI_LN_KABKOTA_2.png" /> ADMINISTRASI_LN_KABKOTA', layer: layer_ADMINISTRASI_LN_KABKOTA_2},
        {label: '<img src="legend/ADMINISTRASI_AR_DESAKEL_1.png" /> ADMINISTRASI_AR_DESAKEL', layer: layer_ADMINISTRASI_AR_DESAKEL_1},
        {label: "OpenStreetMap", layer: layer_OpenStreetMap_0}
    ];

    var lay = L.control.layers.tree(null, overlaysTree, {
        collapsed: true
    });
    lay.addTo(map);

    setBounds();
</script>

<script>
    // TRANSISI ANTAR HALAMAN (tetap dari peta.html sebelumnya)
    (function () {
        const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (prefersReduced) return;

        const links = document.querySelectorAll('a[href$=".html"]:not([target="_blank"])');

        links.forEach(link => {
            link.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (!href || href === '' || href === window.location.pathname.split('/').pop()) {
                    return;
                }
                e.preventDefault();
                document.body.classList.add('page-exit');
                setTimeout(() => {
                    window.location.href = href;
                }, 260);
            });
        });
    })();

    // PARALLAX HEADER (tetap)
    (function () {
        const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (prefersReduced) return;

        const header = document.querySelector('header');
        if (!header) return;

        let ticking = false;

        function onScroll() {
            const scrollY = window.scrollY || window.pageYOffset;
            const offset = scrollY * 0.3;
            header.style.backgroundPosition = `center ${-offset}px`;
            ticking = false;
        }

        window.addEventListener('scroll', function () {
            if (!ticking) {
                window.requestAnimationFrame(onScroll);
                ticking = true;
            }
        });
    })();
</script>

</body>
</html>
